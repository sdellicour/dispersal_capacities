<?xml version="1.0" standalone="yes"?> 
 
<!-- Generated by BEAUTi v1.10.4 Prerelease #bc6cbd9                         --> 
<!--       by Alexei J. Drummond, Andrew Rambaut and Marc A. Suchard         --> 
<!--       Department of Computer Science, University of Auckland and        --> 
<!--       Institute of Evolutionary Biology, University of Edinburgh        --> 
<!--       David Geffen School of Medicine, University of California, Los Angeles--> 
<!--       http://beast.community/                                           --> 
<beast version="1.10.4"> 
	 
	<!-- Insert taxa blocks -->  
	 
	<!-- Insert alignment blocks -->  
 
	<patterns id="patterns" from="1" strip="false">
		<alignment idref="alignment"/>
	</patterns> 
	 
	<!-- Insert starting tree blocks -->

	<statistic id="treeModel.currentTree" name="Current Tree">
		<empiricalTreeDistributionModel idref="treeModel"/>
	</statistic>

	<!-- Statistic for sum of the branch lengths of the tree (tree length)       -->
	<treeLengthStatistic id="treeLength">
		<treeModel idref="treeModel"/>
	</treeLengthStatistic>

	<!-- Statistic for time of most recent common ancestor of tree               -->
	<tmrcaStatistic id="age(root)" absolute="true">
		<treeModel idref="treeModel"/>
	</tmrcaStatistic>
	 
	<!-- START Multivariate diffusion model                                      --> 
	<multivariateDiffusionModel id="location.diffusionModel"> 
		<precisionMatrix> 
			<matrixParameter id="location.precision"> 
				<parameter id="location.precision.col1" value="0.05 0.002"/> 
				<parameter id="location.precision.col2" value="0.002 0.05"/> 
			</matrixParameter> 
		</precisionMatrix> 
	</multivariateDiffusionModel> 
 
	<multivariateWishartPrior id="location.precisionPrior" df="2"> 
		<scaleMatrix> 
			<matrixParameter> 
				<parameter value="1.0 0.0"/> 
				<parameter value="0.0 1.0"/> 
			</matrixParameter> 
		</scaleMatrix> 
		<data> 
			<parameter idref="location.precision"/> 
		</data> 
	</multivariateWishartPrior> 
 
	<arbitraryBranchRates id="location.diffusion.branchRates">
		<treeModel idref="treeModel"/>
		<rates> 
			<parameter id="location.diffusion.rates" lower="0.0"/>
		</rates> 
	</arbitraryBranchRates> 
 
	<distributionLikelihood id="location.diffusion.prior">
		<data>
			<parameter idref="location.diffusion.rates"/>
		</data>
		<distribution>
			<logNormalDistributionModel meanInRealSpace="true">
				<mean>
					<parameter id="ucldDiffusion.mean" value="1.0" lower="0.0"/>
				</mean>
				<stdev>
					<parameter id="ucldDiffusion.stdev" value="5.0" lower="0.0"/>
				</stdev>
			</logNormalDistributionModel>
		</distribution>
	</distributionLikelihood>
 
	<traitDataLikelihood id="location.traitLikelihood" traitName="location" scaleByTime="true" forceFullPrecision="false">
		<multivariateDiffusionModel idref="location.diffusionModel"/>
		<treeModel idref="treeModel"/>
		<traitParameter>
			<parameter id="leaf.location"/>
		</traitParameter>
		<jitter window="0.01 0.01" duplicatesOnly="true">
			<parameter idref="leaf.location"/>
		</jitter>
		<conjugateRootPrior>
			<meanParameter>
				<parameter value="0.0 0.0"/>
			</meanParameter>
			<priorSampleSize>
				<parameter value="0.000001"/>
			</priorSampleSize>
		</conjugateRootPrior>
		<arbitraryBranchRates idref="location.diffusion.branchRates"/>
	</traitDataLikelihood>
	<correlation id="location.correlation" dimension1="1" dimension2="2">
		<matrixParameter idref="location.precision"/>
	</correlation>
	<matrixInverse id="location.varCovar">
		<matrixParameter idref="location.precision"/>
	</matrixInverse>
 
	<!-- END Multivariate diffusion model                                        --> 
 
	<!-- Define operators                                                        --> 
	<operators id="operators" optimizationSchedule="log"> 
		<empiricalTreeDistributionOperator weight="0.1" metropolisHastings="false">
			<empiricalTreeDistributionModel idref="treeModel"/>
		</empiricalTreeDistributionOperator>
<!-- 
		<scaleOperator scaleFactor="0.75" weight="1"> 
			<parameter idref="location.halfDF"/> 
		</scaleOperator> 
 -->
		<hamiltonianMonteCarloOperator weight="20" nSteps="5" stepSize="0.01" mode="vanilla" drawVariance="1.0" autoOptimize="false" gradientCheckCount="0">
			<jointGradient>
				<gradient>
					<distributionLikelihood idref="location.diffusion.prior"/>
					<parameter idref="location.diffusion.rates"/>
 				</gradient>
				<branchRateGradient id="location.branchRateGradient" traitName="location">
					<traitDataLikelihood idref="location.traitLikelihood"/>
				</branchRateGradient>
			</jointGradient>
			<parameter idref="location.diffusion.rates"/>
			<signTransform>
				<parameter idref="location.diffusion.rates"/>
			</signTransform>
		</hamiltonianMonteCarloOperator>
<!-- 
		<scaleOperator scaleFactor="0.75" weight="30">
			<parameter idref="location.diffusion.rates1"/>
		</scaleOperator> 
 -->
		<precisionGibbsOperator weight="5">
			<wishartStatistics  traitName="location">
				<traitDataLikelihood idref="location.traitLikelihood"/>
			</wishartStatistics>
			<multivariateWishartPrior idref="location.precisionPrior"/>
        </precisionGibbsOperator>

		<scaleOperator scaleFactor="0.75" weight="2">
			<parameter idref="ucldDiffusion.stdev"/>
		</scaleOperator> 
	</operators> 
 
	<!-- Define MCMC                                                             --> 
	<mcmc id="mcmc" chainLength="5000000" autoOptimize="true" operatorAnalysis="SIMULATION_NAME.ops"> 
		<joint id="joint"> 
			<prior id="prior"> 
<!-- 
				<exponentialPrior mean="10.0" offset="0.0"> 
					<parameter idref="location.halfDF"/> 
				</exponentialPrior> 
 -->
				<distributionLikelihood idref="location.diffusion.prior"/>
				<multivariateWishartPrior idref="location.precisionPrior"/> 
				<exponentialPrior mean="0.3333333333333333" offset="0">
                     <parameter idref="ucldDiffusion.stdev"/>
				</exponentialPrior>
			</prior> 
			<likelihood id="likelihood"> 
				<multivariateTraitLikelihood idref="location.traitLikelihood"/>
			</likelihood> 
		</joint> 
		<operators idref="operators"/> 
 
		<!-- write log to screen                                                     --> 
		<log id="screenLog" logEvery="10000"> 
			<column label="Joint" dp="4" width="12"> 
				<joint idref="joint"/> 
			</column> 
			<column label="Prior" dp="4" width="12"> 
				<prior idref="prior"/> 
			</column> 
			<column label="Likelihood" dp="4" width="12"> 
				<likelihood idref="likelihood"/> 
			</column> 
			<column label="age(root)" sf="6" width="12">
				<tmrcaStatistic idref="age(root)"/>
			</column>
		</log> 
 
		<!-- write log to file                                                       --> 
		<log id="fileLog" logEvery="10000" fileName="SIMULATION_NAME.log" overwrite="false"> 
			<joint idref="joint"/> 
			<prior idref="prior"/> 
			<likelihood idref="likelihood"/> 
			<statistic idref="treeModel.currentTree"/>
			<!-- START Multivariate diffusion model                                      --> 
			<parameter idref="ucldDiffusion.stdev"/>
			<matrixParameter idref="location.precision"/> 
			<correlation idref="location.correlation"/> 
			<matrixInverse idref="location.varCovar"/> 
			<distributionLikelihood idref="location.diffusion.prior"/>
			<multivariateWishartPrior idref="location.precisionPrior"/>
			<traitDataLikelihood idref="location.traitLikelihood"/>
		</log> 
 
		<!-- write tree log to file                                                  --> 
		<logTree id="treeFileLog" logEvery="10000" nexusFormat="true" fileName="SIMULATION_NAME.trees" sortTranslationTable="true">
			<treeModel idref="treeModel"/>
			<joint idref="joint"/> 
			<trait name="location" tag="location">
				<traitDataLikelihood idref="location.traitLikelihood"/>
			</trait>
			<multivariateDiffusionModel idref="location.diffusionModel"/>
			<traitDataLikelihood idref="location.traitLikelihood"/>
			<trait name="rate" tag="location.rate">
				<arbitraryBranchRates idref="location.diffusion.branchRates"/>
			</trait>
		</logTree> 
	</mcmc> 
	 
	<report> 
		<property name="timer"> 
			<mcmc idref="mcmc"/> 
		</property> 
	</report> 
	 
</beast> 
